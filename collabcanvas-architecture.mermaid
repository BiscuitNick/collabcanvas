graph TB
    subgraph "Browser - Client Side"
        subgraph "React Application"
            subgraph "Pages"
                LP[LoginPage]
                RP[RegisterPage]
                CP[CanvasPage]
            end
            
            subgraph "Components"
                subgraph "Auth Components"
                    LF[LoginForm]
                    RF[RegisterForm]
                end
                
                subgraph "Canvas Components"
                    CAN[Canvas - Konva Stage]
                    RECT[Rectangle]
                    CC[CanvasControls]
                end
                
                subgraph "Multiplayer Components"
                    CUR[Cursor]
                    CL[CursorLayer]
                    PL[PresenceList]
                end
                
                subgraph "Layout Components"
                    HEAD[Header]
                    LAY[Layout]
                end
            end
            
            subgraph "State Management"
                CS[Canvas Store - Zustand]
            end
            
            subgraph "Custom Hooks"
                UA[useAuth]
                US[useShapes]
                UC[useCursors]
                UP[usePresence]
            end
            
            subgraph "Libraries"
                UTIL[Utils - generateId, colors]
                TYPES[TypeScript Types]
            end
        end
        
        subgraph "Rendering Engine"
            KONVA[Konva.js Canvas Renderer]
        end
    end
    
    subgraph "Firebase Backend - Google Cloud"
        subgraph "Firebase Services"
            AUTH[Firebase Authentication]
            FS[Firestore - Document DB]
            RTDB[Realtime Database]
            HOST[Firebase Hosting - CDN]
        end
        
        subgraph "Data Collections"
            subgraph "Firestore"
                SHAPES[/shapes Collection/]
            end
            
            subgraph "Realtime DB"
                CURSORS[/cursors/]
                PRESENCE[/presence/]
            end
        end
        
        subgraph "Security"
            FSR[Firestore Rules]
            DBR[Database Rules]
        end
    end
    
    subgraph "Testing Infrastructure"
        VITEST[Vitest Test Runner]
        TESTS[Test Files]
    end
    
    subgraph "Development Tools"
        VITE[Vite Build Tool]
        TAILWIND[Tailwind CSS]
        TS[TypeScript Compiler]
    end
    
    %% Page Navigation
    LP --> LF
    RP --> RF
    CP --> LAY
    
    %% Layout Structure
    LAY --> HEAD
    LAY --> CAN
    LAY --> CC
    LAY --> CL
    LAY --> PL
    
    %% Canvas Rendering
    CAN --> RECT
    CAN --> KONVA
    RECT --> KONVA
    CL --> CUR
    
    %% Hook Usage in Pages
    CP --> UA
    CP --> US
    CP --> UC
    CP --> UP
    LF --> UA
    RF --> UA
    
    %% Hook to Firebase Connections
    UA -.->|Auth Operations| AUTH
    US -.->|Real-time Listener| SHAPES
    US -.->|Create/Update| SHAPES
    UC -.->|Real-time Listener| CURSORS
    UC -.->|Update Position| CURSORS
    UP -.->|Real-time Listener| PRESENCE
    UP -.->|Write/Remove| PRESENCE
    
    %% Store Usage
    US --> CS
    CC --> CS
    CAN --> CS
    RECT --> CS
    
    %% Utils Usage
    US --> UTIL
    RECT --> UTIL
    UC --> UTIL
    UP --> UTIL
    
    %% Types Usage
    US --> TYPES
    UC --> TYPES
    UP --> TYPES
    CS --> TYPES
    
    %% Firebase Collections
    FS --> SHAPES
    RTDB --> CURSORS
    RTDB --> PRESENCE
    
    %% Security Rules
    FSR -.->|Protect| SHAPES
    DBR -.->|Protect| CURSORS
    DBR -.->|Protect| PRESENCE
    
    %% Authentication Flow
    AUTH -.->|User Session| UA
    AUTH -.->|userId| SHAPES
    AUTH -.->|userId| CURSORS
    AUTH -.->|userId| PRESENCE
    
    %% Testing
    TESTS -.->|Test| UA
    TESTS -.->|Test| US
    TESTS -.->|Test| CS
    TESTS -.->|Test| UTIL
    TESTS -.->|Test| RECT
    VITEST -.->|Run| TESTS
    
    %% Build Process
    VITE -.->|Bundle| CP
    VITE -.->|Bundle| LP
    VITE -.->|Bundle| RP
    TS -.->|Compile| TYPES
    TAILWIND -.->|Style| LAY
    
    %% Deployment
    VITE -.->|Build| HOST
    HOST -.->|Serve| CP
    
    %% Styling
    classDef firebase fill:#FFA611,stroke:#333,stroke-width:2px,color:#000
    classDef react fill:#61DAFB,stroke:#333,stroke-width:2px,color:#000
    classDef konva fill:#00D9FF,stroke:#333,stroke-width:2px,color:#000
    classDef state fill:#FFD43B,stroke:#333,stroke-width:2px,color:#000
    classDef tools fill:#646CFF,stroke:#333,stroke-width:2px,color:#fff
    classDef data fill:#F3722C,stroke:#333,stroke-width:2px,color:#000
    
    class AUTH,FS,RTDB,HOST,FSR,DBR firebase
    class LP,RP,CP,LF,RF,CAN,RECT,CC,CUR,CL,PL,HEAD,LAY react
    class KONVA konva
    class CS,UA,US,UC,UP state
    class VITE,TAILWIND,TS,VITEST,TESTS tools
    class SHAPES,CURSORS,PRESENCE data